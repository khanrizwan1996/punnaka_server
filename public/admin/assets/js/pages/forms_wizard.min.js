var altair_wizard = {
    content_height: function (wizard, step) {
        var height = $(wizard)
            .find(".step-" + step)
            .actual("outerHeight");
        $(wizard).children(".content").animate(
            {
                height: height,
            },
            140,
            bez_easing_swiftOut
        );
    },

    advanced_wizard: function () {
        var wizard = $("#wizard_advanced"),
            form = $("#wizard_advanced_form");

        if (!wizard.length) return;

        wizard.steps({
            headerTag: "h3",
            bodyTag: "section",
            transitionEffect: "slideLeft",
            trigger: "change",

            onInit: function (event, currentIndex) {
                // adjust height
                altair_wizard.content_height(wizard, currentIndex);

                // altair helpers
                altair_forms.textarea_autosize();
                altair_md.checkbox_radio($(".wizard-icheck"));
                altair_forms.select_elements(wizard);
                altair_uikit.reinitialize_grid_margin();
                altair_forms.switches();
                altair_forms.dynamic_fields(wizard, true, true);

                // CKEditor init (SAFE)
                if ($("#editor1").length && !CKEDITOR.instances.editor1) {
                    CKEDITOR.replace("editor1");
                }

                // accordion resize
                $(".uk-accordion").on("toggle.uk.accordion", function () {
                    $window.resize();
                });

                setTimeout(function () {
                    $window.resize();
                }, 100);
            },

            onStepChanged: function (event, currentIndex) {
                altair_wizard.content_height(wizard, currentIndex);
                setTimeout(function () {
                    $window.resize();
                }, 100);
            },

            onStepChanging: function (event, currentIndex, newIndex) {
                var step = wizard.find(".body.current").attr("data-step"),
                    body = $('.body[data-step="' + step + '"]');

                body.find(".parsley-row").each(function () {
                    $(this)
                        .find("input, textarea, select")
                        .each(function () {
                            $(this).parsley().validate();
                        });
                });

                $window.resize();

                return !body.find(".md-input-danger").length;
            },
        });

        // resize on window change
        $window.on("debouncedresize", function () {
            var step = wizard.find(".body.current").attr("data-step");
            altair_wizard.content_height(wizard, step);
        });

        // parsley validation resize fix
        form.parsley()
            .on("form:validated", function () {
                setTimeout(function () {
                    altair_md.update_input(form.find(".md-input"));
                    $window.resize();
                }, 100);
            })
            .on("field:validated", function (e) {
                var el = $(e.$element);
                setTimeout(function () {
                    altair_md.update_input(el);
                    var step = wizard.find(".body.current").attr("data-step");
                    altair_wizard.content_height(wizard, step);
                }, 100);
            });
    },

    vertical_wizard: function () {
        var wizard = $("#wizard_vertical");

        if (!wizard.length) return;

        wizard.steps({
            headerTag: "h3",
            bodyTag: "section",
            enableAllSteps: true,
            enableFinishButton: false,
            transitionEffect: "slideLeft",
            stepsOrientation: "vertical",

            onInit: function (event, currentIndex) {
                altair_wizard.content_height(wizard, currentIndex);
            },

            onStepChanged: function (event, currentIndex) {
                altair_wizard.content_height(wizard, currentIndex);
            },
        });
    },
};

$(function () {
    altair_wizard.advanced_wizard();
    altair_wizard.vertical_wizard();
});

$(document).on("change", "#catmain_id", function () {
    var catmain_id = $(this).val();
    var url = $(this).data("url");

    $.ajax({
        url: url,
        type: "POST",
        data: {
            catmain_id: catmain_id,
            _token: $('meta[name="csrf-token"]').attr("content"),
        },
        success: function (result) {
            $("#catsub_id").html(result);
        },
    });
});